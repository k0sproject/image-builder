From b0de3c650c4d7d20c0aeb86b87f4ec417dfde18f Mon Sep 17 00:00:00 2001
From: Tom Wieczorek <twieczorek@mirantis.com>
Date: Mon, 15 Sep 2025 16:13:46 +0200
Subject: [PATCH] Fix off-by-one error when calculating route table ID lengths

Signed-off-by: Tom Wieczorek <twieczorek@mirantis.com>
---
 felix/config/config_params_test.go | 3 +++
 felix/config/param_types.go        | 5 ++++-
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/felix/config/config_params_test.go b/felix/config/config_params_test.go
index 1a434a9f58a..e941de6faea 100644
--- a/felix/config/config_params_test.go
+++ b/felix/config/config_params_test.go
@@ -776,6 +776,9 @@ var _ = DescribeTable("Config validation",
 	Entry("excessive RouteTableRanges", map[string]string{
 		"RouteTableRanges": "1-100000000",
 	}, false),
+	Entry("excessive RouteTableRanges off-by-one", map[string]string{
+		"RouteTableRanges": "1-65535,99999-99999",
+	}, false),
 	Entry("invalid RouteTableRanges", map[string]string{
 		"RouteTableRanges": "abcde",
 	}, false),
diff --git a/felix/config/param_types.go b/felix/config/param_types.go
index d6556117f6e..817838ebb2a 100644
--- a/felix/config/param_types.go
+++ b/felix/config/param_types.go
@@ -972,7 +972,10 @@ func (p *RouteTableRangesParam) Parse(raw string) (result interface{}, err error
 			return
 		}
 
-		tablesTargeted += max - min
+		// The number of route table IDs in the current range.
+		rangeLen := max - min + 1
+
+		tablesTargeted += rangeLen
 		if tablesTargeted > routeTableRangeMaxTables {
 			err = p.parseFailed(raw, "targets too many tables")
 			return
